#!/usr/bin/env python

import Command
from generators.Generator import Generator
import controllersConfig
from utils.logger import eslog
import os
import configparser
import anbernicFiles
import glob

# Tsugaru_CUI /userdata/bios/fmtowns -CMOS /userdata/roms/fmtowns/CMOS.DAT -HD0 /userdata/roms/fmtowns/harddisk.h0 -HD1 /userdata/roms/fmtowns/harddisk.h1 -CD /userdata/roms/fmtowns/funnybee.tw/funnybee.cue -GAMEPORT0 PHYS0MOUSE -GAMEPORT1 ANA0

class TsugaruGenerator(Generator):

    def generate(self, system, rom, playersControllers, gameResolution):
        romdir = "/userdata/roms/fmtowns"

	# Start emulator fullscreen
        commandArray = ["/usr/bin/Tsugaru_CUI", "/userdata/bios/fmtowns"]

        print(rom)

        # CMOS
        ret = glob.glob(rom+"/CMOS.DAT")
        if len(ret)==0:
            ret = glob.glob(romdir+"/CMOS.DAT")
        if len(ret)>=1:
            commandArray += ["-CMOS", ret[0]]

        # CD
        ret = glob.glob(rom+"/*.cue")
        if len(ret)==0:
            ret = glob.glob(rom+"/*.iso")
        if len(ret)>=1:
            commandArray += ["-CD", ret[0]]

        # HD0
        ret = glob.glob(rom+"/*.h0")
        if len(ret)==0:
            ret = glob.glob(romdir+"/*.h0")
        if len(ret)>=1:
            commandArray += ["-HD0", ret[0]]

        # HD1
        ret = glob.glob(rom+"/*.h1")
        if len(ret)==0:
            ret = glob.glob(romdir+"/*.h1")
        if len(ret)>=1:
            commandArray += ["-HD1", ret[0]]

        # HD2
        ret = glob.glob(rom+"/*.h2")
        if len(ret)==0:
            ret = glob.glob(romdir+"/*.h2")
        if len(ret)>=1:
            commandArray += ["-HD2", ret[0]]

        # FD0
        ret = glob.glob(rom+"/*.f0")
        if len(ret)==0:
            ret = glob.glob(romdir+"/*.f0")
        if len(ret)>=1:
            commandArray += ["-FD0", ret[0]]

        # FD1
        ret = glob.glob(rom+"/*.f1")
        if len(ret)==0:
            ret = glob.glob(romdir+"/*.f1")
        if len(ret)>=1:
            commandArray += ["-FD1", ret[0]]

        # cdboot
        ret = glob.glob(rom+"/cdboot.txt")
        if len(ret)>=1:
            commandArray += ["-BOOTKEY", "CD"]

        # fdboot
        ret = glob.glob(rom+"/fdboot.txt")
        if len(ret)>=1:
            commandArray += ["-BOOTKEY", "F0"]

        commandArray += ["-FREQ", "40"]
        commandArray += ["-USEFPU"]
        commandArray += ["-MEMSIZE", "16"]
        commandArray += ["-GAMEPORT0", "PHYS0"]
        commandArray += ["-GAMEPORT1", "ANA0MOUSE"]
        print(commandArray)

        return Command.Command(array=commandArray)
